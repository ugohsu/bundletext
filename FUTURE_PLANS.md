# FUTURE_PLANS.md: bundletext 機能拡張ロードマップ

本書は、LLM（大規模言語モデル）への入力適合性を高め、かつトークン効率を改善するための `bundletext` スクリプトの改修計画をまとめたものです。

## 1. 目的

- **区切り線の混同防止:** ソースコード内のコメントや装飾として頻出する `===` や `---` と、ファイルの区切りを LLM が混同するリスクを排除する。
- **トークン効率の向上:** 冗長な装飾（区切り線）を削減し、プロンプトのトークン消費を抑える。
- **解析精度の向上:** LLM がファイルパスと中身の境界をより明確に認識できるフォーマットを採用する。

## 2. 変更内容

### 区切り線フォーマットの刷新

現行の独自の区切り線フォーマットを廃止し、よりユニーク性が高く、LLM の学習データ（プロンプトエンジニアリング文脈）と親和性の高い `<<<FILE: path>>>` 形式へ移行します。

**変更前:**
```text
============================================================
FILE_PATH: scripts/myscript.sh
============================================================
#!/bin/bash
...

```

**変更後:**

```text
<<<FILE: scripts/myscript.sh>>>
#!/bin/bash
...

```

**採用理由:**

1. **一意性:** `<<<FILE:` という文字列は、通常のソースコードやコメント内で偶然発生する確率が極めて低い。
2. **Gitマーカーとの区別:** Git のコンフリクトマーカー（`<<<<<<<`）やヒアドキュメント（`<<EOF`）とも明確に区別可能。
3. **トークン削減:** 長い `====` の列を削除することで、ファイルごとに数十トークンの節約になる。

## 3. 実装手順

### `write_bundle` 関数の改修:

1. **ヘッダー出力処理の簡素化:**
* 既存の `out_f.write("=" * 60 ...)` 部分および `FILE_PATH:` 出力部分を削除。
* 代わりに `out_f.write(f"<<<FILE: {disp}>>>\n")` を出力する。


2. **コンテンツ出力:**
* 従来通り、プレーンテキストとしてそのまま出力する。



### `AI INSTRUCTIONS` の更新:

デフォルトのインストラクション（`DEFAULT_INSTRUCTIONS`）内の記述を、新しいフォーマットに合わせて更新する。

**変更前:**
`2) File Contents: each file begins with FILE_PATH.`

**変更後:**
`2) File Contents: each file begins with <<<FILE: path>>>.`
