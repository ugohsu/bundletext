# FUTURE_PLANS.md: bundletext 機能拡張ロードマップ

本書は、LLM（大規模言語モデル）への入力適合性を高めるための、`bundletext` スクリプトの機能拡張計画をまとめたものです。

## 1. 目的

- **区切り線の混同防止:** ファイルの区切り線（`===`）と、ソースコード内のコメント等に含まれる区切り線を LLM が混同するのを防ぐ。
- **トークン効率の向上:** LLM がヘッダーを読むだけで、ファイルの複雑さや規模を即座に見積もれるようにする。
- **構造理解の強化:** 行番号という明確なマーカーを付与することで、AI がコードブロックの開始と終了を物理的に認識できるようにする。

## 2. 実装予定の機能

### A. ヘッダーへの `LINE_COUNT` 追加

各ファイルブロックのヘッダーに `LINE_COUNT`（総行数）フィールドを追加します。

**出力フォーマット:**

```text
============================================================
FILE_PATH: scripts/target_script.py
LINE_COUNT: 150
============================================================

```

### B. 行番号の常時付与とパディング統一

すべてのファイルの中身に対して、**行番号を付与**します。
また、**バンドルに含まれる全ファイルの中で最大の行数**に合わせて、行番号のパディング（桁数）を統一します。

**仕様:**

1. オプションではなく、常に有効とします。
2. **パディングの統一:**
* 例えば、バンドル内に最大行数が `1500`行（4桁）のファイルがある場合、わずか `5`行しかないファイルであっても、行番号は4桁分の幅でスペース埋めされます。
* これにより、ファイルごとのインデントのズレを防ぎ、LLM にとって読みやすい整形式テキストを提供します。



**出力例（最大行数が 3桁 の場合）:**

```text
  1 | #!/usr/bin/env python3
  2 | import sys
...
150 | if __name__ == "__main__":

```

## 3. 実装の指針

### `write_bundle` 関数の改修プロセス:

1. **全ファイルの先行スキャン:**
* 書き込みを開始する前に、出力対象となるすべてのファイル（`included`）の中身を確認し、それぞれの行数を取得します。
* 全ファイルの中での「最大行数（`max_lines`）」を特定します。


2. **パディング幅の決定:**
* `pad_width = len(str(max_lines))` を計算し、全ファイル共通のパディング幅として保持します。


3. **書き込みループ:**
* 各ファイルを出力する際、ヘッダーに `LINE_COUNT` を記載します。
* コンテンツの各行に対し、計算した `pad_width` を用いて右寄せで行番号を整形し、`|` 区切りで出力します。
* Python format例: `f"{line_num:>{pad_width}} | {content}"`
